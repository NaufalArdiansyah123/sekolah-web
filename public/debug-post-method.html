<!DOCTYPE html>
<html>
<head>
    <title>Debug POST Method Error</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; }
        .error { color: red; }
        .success { color: green; }
        .warning { color: orange; }
        form { margin: 10px 0; padding: 10px; background: #f9f9f9; }
        button { padding: 10px 20px; margin: 5px; }
        .approve { background: green; color: white; }
        .reject { background: red; color: white; }
        #debug-output { background: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Debug POST Method Error</h1>
    
    <div class="section">
        <h2>Problem Analysis</h2>
        <p class="error">Error: "The POST method is not supported for route admin/extracurriculars/all-registrations"</p>
        <p>This means forms are still submitting to the wrong URL.</p>
    </div>
    
    <div class="section">
        <h2>Test 1: Direct Form Submission</h2>
        <p>These forms should submit to the CORRECT URLs:</p>
        
        <form method="POST" action="http://127.0.0.1:8000/admin/extracurriculars/registration/1/approve" 
              onsubmit="return testSubmit(this, event)">
            <input type="hidden" name="_token" value="test-csrf-token">
            <button type="submit" class="approve">✓ Test Approve (Correct URL)</button>
        </form>
        
        <form method="POST" action="http://127.0.0.1:8000/admin/extracurriculars/registration/1/reject" 
              onsubmit="return testSubmit(this, event)">
            <input type="hidden" name="_token" value="test-csrf-token">
            <input type="hidden" name="notes" value="Test rejection">
            <button type="submit" class="reject">✗ Test Reject (Correct URL)</button>
        </form>
    </div>
    
    <div class="section">
        <h2>Test 2: Wrong URL (This should cause the error)</h2>
        <form method="POST" action="http://127.0.0.1:8000/admin/extracurriculars/all-registrations" 
              onsubmit="return testSubmit(this, event)">
            <input type="hidden" name="_token" value="test-csrf-token">
            <button type="submit" class="error">❌ Wrong URL (Will cause error)</button>
        </form>
    </div>
    
    <div class="section">
        <h2>Debug Information</h2>
        <div id="debug-output">
            <p>Click any button above to see debug information here.</p>
        </div>
    </div>
    
    <div class="section">
        <h2>Solution Steps</h2>
        <ol>
            <li class="success">✅ Clear browser cache completely (Ctrl+Shift+Delete)</li>
            <li class="success">✅ Hard refresh the page (Ctrl+F5)</li>
            <li class="success">✅ Check browser Network tab (F12) to see actual requests</li>
            <li class="success">✅ Verify CSRF token is present</li>
            <li class="success">✅ Make sure you are logged in as admin</li>
            <li class="warning">⚠️ Check for any JavaScript that might be intercepting forms</li>
        </ol>
    </div>
    
    <div class="section">
        <h2>URLs to Test</h2>
        <ul>
            <li><a href="http://127.0.0.1:8000/admin/test-clean-approval" target="_blank">Clean Test Page</a></li>
            <li><a href="http://127.0.0.1:8000/admin/extracurriculars/all-registrations" target="_blank">All Registrations</a></li>
            <li><a href="http://127.0.0.1:8000/admin/dashboard" target="_blank">Admin Dashboard</a></li>
        </ul>
    </div>
    
    <script>
    function testSubmit(form, event) {
        event.preventDefault(); // Prevent actual submission for testing
        
        const debugOutput = document.getElementById("debug-output");
        const formData = new FormData(form);
        
        let output = "<h3>Form Debug Information:</h3>";
        output += "<p><strong>Action:</strong> " + form.action + "</p>";
        output += "<p><strong>Method:</strong> " + form.method + "</p>";
        output += "<p><strong>Form Data:</strong></p><ul>";
        
        for (let [key, value] of formData.entries()) {
            output += "<li>" + key + ": " + value + "</li>";
        }
        output += "</ul>";
        
        if (form.action.includes("/all-registrations")) {
            output += "<p class=\"error\"><strong>❌ PROBLEM FOUND:</strong> Form is submitting to wrong URL!</p>";
            output += "<p class=\"error\">This will cause the POST method error.</p>";
        } else if (form.action.includes("/approve") || form.action.includes("/reject")) {
            output += "<p class=\"success\"><strong>✅ CORRECT:</strong> Form is submitting to the right URL!</p>";
            output += "<p class=\"success\">This should work properly.</p>";
        }
        
        debugOutput.innerHTML = output;
        
        console.log("Form submission test:", {
            action: form.action,
            method: form.method,
            formData: Object.fromEntries(formData)
        });
        
        return false; // Prevent actual submission
    }
    
    // Log page load
    console.log("Debug page loaded. Check forms and test submissions.");
    </script>
</body>
</html>